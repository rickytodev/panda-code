name: C/C++ CI

on:
    push:
        branches: ["main"]
    pull_request:
        branches: ["main"]

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v3

            - name: Install GCC
              run: sudo apt-get update && sudo apt-get install -y gcc

            - name: Build all exercises
              run: |
                mkdir -p build
                for folder in src/*/; do
                  exercise=$(basename "$folder")
                  mkdir -p "build/$exercise"
                  for cfile in "$folder"*.c; do
                    if [ -f "$cfile" ]; then
                      filename=$(basename "$cfile" .c)
                      echo "Building $exercise/$filename.c..."
                      gcc "$cfile" -o "build/$exercise/$filename"
                    fi
                  done
                done

            - name: Verify builds
              run: |
                echo "Built executables:"
                find build -type f -executable
